<section>
  <h1>Your Dashboard</h1>
  <%= link_to 'Downgrade Merchant to User', admin_downgrade_merchant_path(@user), method: :put if current_admin?  %>
  <%= render partial: '/users/profile' %>
  <div class="statistics">
    Top 5 Items: <% @user.top_items_for_merchant(5).each do |item| %>
      <li><%= item.name %>: <%= item.total_quantity %> sold</li>
    <% end %>
    <p>Items Sold: You have sold <%= @user.items_sold_by_quantity %> items which is <%=number_to_percentage((@user.items_sold_by_percentage).round(2) * 100) %> of your total inventory. </p>
    Top 3 States: <% @user.top_states(3).each do |state| %>
      <li><%= state.state %>: <%= state.state_quantity %> sold</li>
    <% end %>
    Top 3 Cities: <% @user.top_cities(3).each do |city| %>
      <li><%= city.location %>: <%= city.city_quantity %> sold</li>
    <% end %>
    <p>Customer With Most Orders: <%= @user.top_customer_by_orders.name if @user.top_customer_by_orders %> </p>
    <p>Customer With Most Items: <%= @user.top_customer_by_items.name if @user.top_customer_by_items %> </p>
    Biggest Spenders: <% @user.top_spenders(3).each do |user| %>
      <li><%= user.name %>: <%= number_to_currency(user.total_spent) %> spent</li>
    <% end %>
  </div>
  <% @orders.each do |order| %>
    <div class="order-<%= order.id %>">
      <p>Order ID: <%= link_to "#{order.id}", merchant_order_path(order) if current_merchant? %>
       <%= link_to "#{order.id}", admin_order_path(order) if current_admin? %></p>
      <p>Created on: <%= order.created_at.strftime("%m-%d-%Y") %> </p>
      <p>Total items: <%= order.total_items_for_merchant(@user) %> </p>
      <p>Amount: <%= order.total_value_for_merchant(@user) %> </p>
    </div>
  <% end %>
  <%= link_to 'My Items', dashboard_items_path if current_merchant? %>
  <%= link_to 'My Items', admin_merchant_items_path(@user) if current_admin? %>
</section>
